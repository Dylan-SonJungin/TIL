# 도커의 탄생 배경

- 기존 로컬에서 개발을 해, 서버에 올릴때 소스파일만 올리는 것으로는 문제가 있다.

- PC마다 환경이다르고, 각종 의존성등을 설정 해줘야하기 때문에!!

- history

  사실 개발을 하기 위해 하나의 환경을 구축하기 위해서는 꽤 많은 수고가 들어간다.

  1. 서버가 있어야하고,
  2. OS를 구축해야하고,
  3. 개발을 위한 네트워크 통신 포트 구성과, 개발 툴들의 설치,
  4. 개발 툴들의 연동 환경 구성 등등..에
  5. 호환성을 생각해 툴의 버전과 OS버전을 맞추기까지 해야했다.

  그럼 이런 환경을 각 서버나 개발자의 PC 별로 일일히 설치하기엔 반복적인 일을 너무 많이 해야겠죠

  심지여 여기서 환경 구성이 잘못되거나, 에러가 발생하면, 처음부터 다시구성해야할수도있어요

  이런 반복적이고, 불편한 세팅을 한번 해놓으면 쉽게 그 설정을 배포할 수 있다면?

  **너무좋겠죠**

<aside> 🤖 **도커는 이런걸 해결해줍니다.**

내 PC에서는 되는데 쟤 PC에서는 안돼요.. 이걸 구동시키려면, 이것도 설치하고,, 저것도설치하고.. 또 뭐 해야하더라?

</aside>

# 도커란 무엇인가?

- 도커는 컨테이너 기술을 기반으로 한 일종의 가상화 플랫폼이자 패키징 툴이다.
- 도커는 독립된 환경을 만들어서 하드웨어를 효율적으로 활용하는 기술!
- 컨테이너에 우리의 어플리케이션과 그에 필요한 툴, 환경설정 모든 디펜던시를 묶어 다른PC, 다른서버에서도 쉽게 배포하고 안정적으로 구동하게 도와준다!

<aside> 🤖 **컨테이너란 무엇인가요?**

컨테이너가 실행되고 있는 호스트 os의 기능을 그대로 사용하면서, 프로세스를 격리해 독립된 환경을 만드는 기술입니다!

</aside>

<aside> 🤖 **가상화란 무엇인가요?**

하나의 하드웨어를 여러 개의 가상 머신으로 분할해 효율적으로 사용 할 수 있게 해주는 기술

분할된 가상 머신들은 각각 독립적인 환경으로 구동된다.

이때, 근본이 되는 기존의 환경을 `Host OS` 가상머신으로 분할된 각각의 환경을 `Guest OS` 라 한다.

</aside>

# 가상머신과 컨테이너(도커)

![컨테이너와 가상 머신(VM): 차이점은 무엇일까요? |NetApp 블로그](https://www.netapp.com/ko/media/Screen-Shot-2018-03-20-at-9.24.09-AM_tcm25-56643.png)

### **가상 머신**은 어떻게 작동할까?

- 가상 머신을 생성하기 위해서는 하이퍼 바이저 또는 가상 머신 모니터라고 불리는 소프트웨어를 이용한다.

- 하이퍼바이저는 호스트 하드웨어에 설치되어 호스트와 게스트를 나누는 역할을 하고, 각각의 게스트는 하이퍼바이저에 의해 관리되며, 시스템 자원을 할당받게 된다.

- 이때, 하이퍼 바이저에 의해 생성된 게스트는 호스트나 다른 게스트와 상호 간섭하지 않고 완전히 분리되어 작동한다.

- 하지만, 가상 머신으로 무언갈 하려면, 반드시 하이퍼 바이저를 거쳐야 하기 때문에, **속도 저하가 필연적으로 발생**하게 된다!

- 하이퍼바이저 이름을 뜯어보자

  VM은 각각 독립적인 OS를 가지며 Application을 띄우고 Process를 올리는 것을 OS가 수행하고 관리한다. 따라서 일반적으로 운영체제를 supervisor (감독자)라고 부른다. 위 그림에서 처럼 Guest OS가 supervisor라면, 하이퍼바이저는 supervisor들을 관리하는 supervisor인 셈이 된다 그래서 슈퍼보다 쌘 하이퍼다.

<aside> 🤖 **하이퍼 바이저를 이용한 가상화방법 두가지!**

전가상화 : 하드웨어를 완전히 가상화 하는 방식 반가상화 : 하드웨어를 완전히 가상화 하지 않는 방식

</aside>

## 컨테이너(도커)

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/440e0051-e1a6-4fc1-b7a8-96dc6ee9928e/10ed169d-21af-4559-8417-ac821ea86292/Untitled.png)

- 기존 VM을 이용한 가상화방법이 성능 문제가 있어 **프로세스를 격리**하기 위해 나옴
- 논리적인 공간(컨테이너)를 만들어 다양한 어플리케이션을 설치해 하나의 서버처럼 사용할 수 있는 패키지 이다.
- 따라서 필요한 OS 만드는 작업 및 Infra를 독립적으로 나눌 필요가 없어서 확장성이 좋고 빠르다.

### 컨테이너 동작원리

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/440e0051-e1a6-4fc1-b7a8-96dc6ee9928e/a93078d7-1bad-4047-8e39-e2eb1ac570d4/Untitled.png)

- 일단 도커 컨테이너 기술을 좀더 자세하게 알아야합니다.

- 도커의 컨테이너 기술은 리눅스의 컨테이너를 활용한 기술로, 컴퓨터에 독립적인 컴퓨팅 공간을 만들어 낸다.

- 위의 사진처럼 도커 컨테이너는 호스트 OS의 커널을 공유하며 단순히 하나의 격리되어있는 프로세스로 동작한다.

  <aside> 🤖 **동일한 OS에서 어떻게 다수의 프로세스가 커널을 공유함과 동시에 가상화가 될 수 있는가?**

  👉도커는 컨테이너라는 가상의 ‘격리환경’을 만들기 위해 리눅스의 `namespace`와 `cgroup`이라는 기능을 사용한다.

  </aside>

  - 질문이 어렵죠? 저도 뭔말인지 몰라서 좀 찾아봤어요

    ⇒ **일단  커널을 공유한다.** 이말을 좀 이해해 봅시다. 커널을 공유한다? 이말을 설명해보면 ⇒ 모든 프로세스는 운영체저의 커널을 공유합니다. 커널은 시스템(OS) 핵심 부분으로, 자원을 효율적으로 관리하고 프로세스 간의 통신을 조율해요 프로세스들이 커널을 공유하면서 서로 간섭하지 않고 동작 할 수 있는거죠 그렇다면, 이제 가상화를 다시한번 짚어봅시다. 가상화를 하는 이유는 하나의 물리적인 컴퓨터에서 여러 독립적인, 격리된 환경을 가지게 해서 효율적으로 사용하기 위해서이죠. **격리된 환경이 필요해서에요**

    그럼 이를 합쳐보면, 커널을 공유한다는 것은, **여러 프로세스간의 자원 공유를 허용하지만**, **가상화를 해서 격리된 환경을 만드는게 어떻게 되냐?** 라는 질문인거에요

    다시말하면 **하나의 OS에서 자원을 관리하는데, 공유가되니까, 자원을 사용하려는 충돌을 어떻게 회피하는가? 라는 질문인거죠**

    이걸 `namespace`와 `cgroup`이라는 친구들로 해결합니다.

### namespace

- 프로세스 별로 리소스 사용을 분리한다.
- Hardware 자원 자체를 가상화 하는 것이 아니라, Linux 내의 자원을 가상화한다.
  - pid name spaces : 프로세스 격리 처리 (독립된 프로세스 공간 할당)
  - net name spaces : 네트워크 인터페이스
  - ipc name spaces : IPC 자원에 대한 엑세스 관리
  - mnt name spaces : 파일 시스템 포인트 관리
  - uts name spaces : host name 할당

### cgroup

- Control Groups의 약자로 프로세스들이 사용할 수 있는 컴퓨팅 자원들을 제한하고 격리 시킬 수 있는 리눅스 커널의 기능

- cgroups을 이용해 다음과 같은 자원들을 제한할 수 있다.

  - 메모리
  - CPU
  - Device
  - I/O
  - Network

  ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/440e0051-e1a6-4fc1-b7a8-96dc6ee9928e/76e51e6f-7d4a-49ea-adca-006c4c5363ab/Untitled.png)

  **⇒ 즉, 컨테이너는 프로세스를 격리하고, 프로세스에 필요한 컴퓨팅 자원을 독립적으로 할당 / 격리하여 완벽히 격리된 가상 환경을 구축하게 해준다.**

  