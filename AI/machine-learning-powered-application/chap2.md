# Chap2. 계획 수립하기

> 머신러닝의 **필요성** 예측, **적절하게** 적용할 수 있는 곳을 찾아 **목표를** 설정
>
> ❌*머신러닝이 항상 필요하지는 않다*❌

<br/>

## 2.1 성공 측정하기

#### 2.1.1 비즈니스 성능

- `오직 제품의 성공을 반영`
  - 제품의 성공 지표 = 사용자 수, 상품 클릭률 (CTR) 등
  - 가드레일 메트릭 (Gardrail Metric) : 특정 지점 아래로 내려가면 안되는 기준
- Chap1 에디터 → *추천의 유용성* 측정
  - 추천을 선택한 횟수의 비율 → 인터페이스가 사용자가 제안을 수락했는지 감지




<br/>

#### 2.1.2 모델 성능

- `오프라인 메트릭 (Offline Metric)` + `모델 메트릭 (Model Metric)` = 모델을 사용자에게 노출하지 않고 평가

1. **모델과 제품 사이의 상호작용을 바꾸자**

   - EX. 검색어 입력 시 추천 단어 제시
     1. *다음 단어를 올바르게 예측한 빈도*를 단어 수준의 정확도로 계산하여 모델의 성능을 측정
     2. 입력 상품을 상품 카테고리로 분류하고, 가장 가능성 있는 3개의 카테고리를 추천 → ***카테고리에 대한 정확도***를 사용해 모델의 성능 측정

   - 모델링 작업을 쉽게 만들기 위한 수정 방법
     1. 인터페이스 수정: 신뢰도가 기준 이하인 경우, 모델의 출력 결과 생략
        1. 다른 결과 제시: 최상 모델 예측 + 기타 모델 예측 + 경험적 규칙 결과 + ....
        2. 사용자와 소통: 피드백은 필수

<br/>

2. **제품 성능에 잘 맞는 모델 측정 지표를 추가로 만들자**

   - EX. 스케치에서 HTML 자동 생성

     1. Cross-Entropy Loss 를 사용해 예측된 HTML token / 온바른 token 비교 → *정렬 상태 비교 ❌*
     2.  최적화 지표 이상을 고려하도록 BLEU 점수 사용

     <img src="https://i0.wp.com/sefiks.com/wp-content/uploads/2017/12/one-hot-encoding.png?resize=1140%2C608&ssl=1" alt="cross" style="zoom:30%;" />

​							<img src="https://www.elastic.co/search-labs/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Fme0ej585%2Fsearch-labs-import-testing%2F1864fc29ad684a694d048b94eab850d68aeeac49-1235x473.png&w=3840&q=75" alt="bleu" style="zoom:30%;" />



<br/>

3. **현실적인 성능을 전제로 제품을 설계하자**

   → 모델의 완벽한 성능을 전제로 제품을 설계하면 위험하다

   - EX. 약 사진으로 환자에게 약의 종류와 복용량을 알려주는 모델
     - 최악의 정확도는? 사용자에게 위험을 안기지 않는 방법은? ...

   

   

   <br/>

4. **정밀도를 높여 시스템의 품질을 높이자**

   - Chap1 에디터에서는 부적절한 추천을 최소화하기 위해 높은 정밀도를 우선시
     - `정밀도 (Precision)`: 모델이 '좋다'고 예측한 질문 중 실제로 좋은 질문의 비율을 의미
     - `재현율 (Recall)` : 데이터셋에 있는 좋은 질문 전체에서 모델이 좋은 질문으로 예측한 비율
   - 정밀도가 높은 모델 → 질문을 좋은 것으로 분류 or 추천 시 정확도가 더 높다
   - `검증 세트 (Validation Set)` 을 이용하여 측정값 계산

   <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Precisionrecall.svg/1200px-Precisionrecall.svg.png" alt="t" style="zoom:20%;" />

   <img src="https://miro.medium.com/v2/resize:fit:1400/1*pOtBHai4jFd-ujaNXPilRg.png" alt="p" style="zoom:60%;" />



<br/>

#### 2.1.3 최신성과 분포 변화

지도학습 모델의 **예측 성능** → 입력 특성과 예측 타깃 사이의 **연관성 학습** 을 통해

- EX. 샌프란시스코 강수량을 통해 교통 상황 예측 모델
  1. 지난 3개월 데이터 사용하여 10월 모델 제작 → 강수량 1인치 미만
  2. 계절이 변하며 평균 강수량은 3인치로 상승  → 모델 성능 부정확
- `데이터 최신성 (Freshness)` 요구됨
  - 최신 데이터로 모델을 다시 훈련? 비용은?
  - Chap1 에디터: '잘 쓰인 문장' 의 변화 주기 = 1년, 하지만 주제에 따라 최신성에 대한 요구는 다르다 (수학은 느리고, 음악은 빠르다)
  - 애플리케이션의 인기가 높으면 데이터 수집 요구 용이: 사용자가 출력의 품질을 평가하는 버튼을 추가→  사용자의 원래 입력 + 모델 예측 + 관련된 사용자 평가를 모아 훈련 세트로 사용

<br/>

#### 2.1.4 속도

**빠르게**! → 사용자와 모델의 상호작용 용이 + 동시에 많은 사용자에게 제공

- 짧은 문장을 번역 → 즉시, 의료 영상 분석 → 24시간

- Chap1 에디터

  1.  사용자가 입력 상자에  입력하고, 등록 버튼을 눌러서 결과 출력

  2. 사용자가 새로운 글자를 입력할 때마다 *동적*으로 결과를 업데이트

     → 모델은 1초 이내에 작동해야함 (2초 이내 전체 파이프라인 통과)

- 모델의 추론시간은 복잡함에 비례

  - NLP 중 LSTM 은 Random Forest 에 비해 약 3배 느림, 동시에 많은 샘플에 대한 추론을 할 시 차이 커짐

- 추론 수행 과정에 여러 네트워크 호출과 데이터베이스 쿼리가 연관된 복잡한 애플리케이션 → 실행 시간이 나머지 애플리케이션 로직에 비해 짧음
  → 이 경우에는 모델의 속도 문제 X



<br/><br/>

## 2.2 작업 범위와 문제점 예상하기

> 💡성공적인 머신러닝을 위해서는 **문제를 잘 이해**하고, **좋은 데이터셋**을 확보하여 **적절한 모델**을 만들어야 한다!

#### 2.2.1  도메인 전문 지식 활용하기

1. **전문가로부터 배우기**
   - EX. 공장 설비 유지 보수 예측 시스템
     - 유지보수가 필요한 기계인가? 구분하는 증상은? 법률적인 조건은? ...
   - EX. 어떤 웹사이트의 고유한 기능 에 대한 사용성을 예측 → *독점적인 데이터* 사용
     - 전문가를 찾기 어려움 →  비슷한 문제를 해결했던 전문가에게 도움



<br/>

2. **데이터 조사하기**
   - **탐색적 데이터 분석 (Exploratory Data Analysis)**: 데이터셋을 탐색하고 시각화하는 과정
     - 비즈니스 문제에 대한 직관을 얻기 위함
     - 데이터의 트렌드를 이해
     - 직접 레이블 부여 → 문제를 해결하기 위한 규칙 발견



<br/>

#### 2.2.2 거인의 어깨 위에 올라서기 (다른 사람들은 문제를 어떻게 해결했나)

> 💡시작하기 가장 좋은 방법은 *기존의 결과*를 이해하고 재현해보는 것!
>      비슷한 모델이나 데이터셋으로 만들 오픈 모델을 참고해보자
>
> 오픈 소스코드와 데이터셋은 *사용권한과 라이선스*를 꼭 확인해보자

1. **오픈 데이터**

   - 비슷한 데이터셋이란? → 분야가 다르더라도! *비슷한 형태의 입력과 출력*을 가진 데이터셋

     - EX. 텍스트로 음식 종류 예측 & 악보 코드로부터 음악 장르 예측
     - EX.  뉴스 기사의 조회 수를 예측하는 모델
       - 데이터셋 존재 X   → 위키백과 트래픽 통계 데이터셋을 사용하여 예측 모델 훈련
     - 독점적인 데이터를 다루는 상황에서도 유용!
       -  비슷한 데이터셋에서 잘 동작하는 모델을 구축한 후, 새로운 데이터 수집 파이프라인을 구축OR 기존의 파이프라인을 사용할 권한

     - Kaggle, Internet Archive, r/datasets, commoncrawl.org 등등

   <br/>

   

2. **오픈 소스 코드**

   - 제품의 목표와 동일한 문제를 해결하는 파이프라인과 서 선택한 데이터셋을 다루는 코드 참고
   - EX. 스크린샷에서 HTML 코드 생성
     - 이미지 시퀀스 변환 어려움 → Image Captioning 의 기존 구조와 모범 사례 활용
     - 유사한 어플리케이션이 쌓아온 수년간의 성과 활용

<br/>

3. **두 작업 합치기**

    i.  비슷한 오픈 소스 모델 → 훈련된 데이터셋도 함께 찾아 직접 훈련 결과를 재현

   ii. 주어진 문제에 가장 가까운 데이터셋→ 이 데이터셋으로 앞에서 찾은 모델을 훈련

   iii. 사전에 정의한 측정 지표를 사용하여 모델의 성능을 판단하고 반복



<br/>

## 2.3 머신러닝 에디터(Chap 01) 계획하기

#### 2.3.1 초기 계획

- 데이터셋: Q&A 커뮤니티의 '좋아요'/'찬성' 지표 활용
  - +레이블을 달면서 패턴 찾기
- 모델: Scikit-Learn 의 *텍스트 분류 튜토리얼* 참고



<br/>

#### 2.3.2 간단한 모델로 시작하기

- 초기 목적 = 더 나은 제품을 위해 *필요한 모델링*과 *데이터 수집 작업*에 도움이 될 정보를 만드는 것
- 주의할 점
  - 질문에 답변하는 것은 문장 품질보다 더 많은 요소에 의존
    - 질문 문맥, 작성자 인기도, 작성 시간 등 세부 사항 존재 → 특정 커뮤니티로 *제한*
    - Metadata 는 무시하도록!
  - 원하는 출력에 약하게 연관되어 있는` Weak Label(유사 레이블)` 사용



<br/>

## 2.4 규칙적인 향상 방법: 간단하게 시작하기

> 간단한 모델로 시작 → 프로토타입 구축 →  제품의 목표에 맞는 성능 평가 (최적화 ❌)

#### 2.4.1 간단한 파이프라인으로 시작하기

<img src="https://blog.kakaocdn.net/dn/chPsRL/btrCmSFJPrg/HIVHhsMLUeG5sIG3UsBle0/img.png" alt="ㅇ" style="zoom:40%;" />

1. **훈련**
   - 모델이 데이터의 패턴을 학습하여 일반화된 규칙을 찾아내는 과정
   - 레이블된 데이터셋 → 모델 → 모델 훈련 반복
   - 입력 데이터와 정답 레이블(Ground Truth)이 모두 필요
2. **추론**
   - 훈련된 모델을 사용하여 새로운 입력에 대한 예측을 수행
   - 제품용, 훈련된 모델의 결과를 *사용자에게 전달*
   - 전처리/후처리 파이프라인의 효율성과 에러 처리가 매우 중요
     - 전처리 = 정제, 검증, Feature 생성, 적합한 형변환, ..
     - 복잡한 시스템의 경우 DB 에 저장된 추가 정보를 가져오기도 함



<br/>

#### 2.4.2 머신러닝 에디터를 위한 파이프라인

1. **기본적인 파이프라인** for End-to-End

   -  데이터 레코드 적재 (데이터를 데이터 베이스나 데이터 웨어하우스에 저장하는 과정)
   - 불완전한 레코드를 삭제하고 필요시 누락된 값을 채워서 데이터 정제하기 
   - 모델이 이해할 수 있는 형태로 데이터 포맷을 맞추고 전처리하기
   - 모델 결과를 검증하기 위해 훈련에 사용하지 않을 데이터(검증 세트) 떼어놓기
   - 주어진 데이터로 모델을 훈련하고 훈련된 모델과 요약 통계 반환하기

   <img src="https://learn.microsoft.com/ko-kr/azure/architecture/data-guide/images/etl.png" alt="ㅇㅇ" style="zoom:25%;" />

<br/>

2. **추론** : 훈련 파이프라인의 함수 일부를 활용하거나 수정하여 사용
   - (빠른 실행을 위해서) 훈련된 모델을 로드하고 메모리에 적재하기
   - (훈련과 동일하게) 전처리 수행하기
   - 관련 있는 외부 정보 수집하기
   - 하나의 샘플을 모델(추론 함수)에 통과시키기
   - 사용자에게 제공하기 전에 결과를 정리하는 후처리 수행하기



<br/>

3. **문제 진단**
   - 모델의 예측이 최상인 샘플과 최악인 샘플을 시각화하는 함수
   - 데이터를 탐색하는 함수
   - 모델의 결과를 탐색하는 함수
